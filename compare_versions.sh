#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –¥–≤–æ—Ö –≤–µ—Ä—Å—ñ–π –≤–∏—Ç—è–≥–Ω—É—Ç–æ–≥–æ –∫–æ–¥—É

if [ "$#" -ne 2 ]; then
    echo "=========================================="
    echo "  –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –≤–∏—Ç—è–≥–Ω—É—Ç–æ–≥–æ –∫–æ–¥—É"
    echo "=========================================="
    echo ""
    echo "–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:"
    echo "  $0 <–ø–∞–ø–∫–∞_–≤–µ—Ä—Å—ñ—è_1> <–ø–∞–ø–∫–∞_–≤–µ—Ä—Å—ñ—è_2>"
    echo ""
    echo "–ü—Ä–∏–∫–ª–∞–¥:"
    echo "  $0 unitpro_v1_extracted unitpro_v2_extracted"
    exit 1
fi

DIR1="$1"
DIR2="$2"

if [ ! -d "$DIR1" ]; then
    echo "‚ùå –ü–æ–º–∏–ª–∫–∞: –ø–∞–ø–∫–∞ '$DIR1' –Ω–µ —ñ—Å–Ω—É—î"
    exit 1
fi

if [ ! -d "$DIR2" ]; then
    echo "‚ùå –ü–æ–º–∏–ª–∫–∞: –ø–∞–ø–∫–∞ '$DIR2' –Ω–µ —ñ—Å–Ω—É—î"
    exit 1
fi

echo "=========================================="
echo "  –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –≤–∏—Ç—è–≥–Ω—É—Ç–æ–≥–æ –∫–æ–¥—É"
echo "=========================================="
echo ""
echo "üìÅ –í–µ—Ä—Å—ñ—è 1: $DIR1"
echo "üìÅ –í–µ—Ä—Å—ñ—è 2: $DIR2"
echo ""

# –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ –∫–æ–ª—å–æ—Ä–æ–≤–∏–º –≤–∏–≤–æ–¥–æ–º —è–∫—â–æ –¥–æ—Å—Ç—É–ø–Ω–æ
if command -v colordiff &> /dev/null; then
    DIFF_CMD="colordiff"
else
    DIFF_CMD="diff"
fi

# –í–∏–∫–æ–Ω–∞—Ç–∏ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è
echo "üîç –í–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è..."
echo ""

$DIFF_CMD -r -u "$DIR1" "$DIR2" | tee comparison_result.txt

if [ ${PIPESTATUS[0]} -eq 0 ]; then
    echo ""
    echo "‚úÖ –§–∞–π–ª–∏ —ñ–¥–µ–Ω—Ç–∏—á–Ω—ñ - –Ω–µ–º–∞—î –∑–º—ñ–Ω —É –∫–æ–¥—ñ!"
else
    echo ""
    echo "üìù –ó–Ω–∞–π–¥–µ–Ω–æ –≤—ñ–¥–º—ñ–Ω–Ω–æ—Å—Ç—ñ (–∑–±–µ—Ä–µ–∂–µ–Ω–æ —É comparison_result.txt)"
    echo ""
    echo "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–º—ñ–Ω:"
    
    # –ü–æ—Ä–∞—Ö—É–≤–∞—Ç–∏ –∑–º—ñ–Ω–µ–Ω—ñ —Ñ–∞–π–ª–∏
    CHANGED_FILES=$(grep -E "^diff -r" comparison_result.txt | wc -l)
    ADDED_LINES=$(grep -E "^\+" comparison_result.txt | grep -v "^+++" | wc -l)
    REMOVED_LINES=$(grep -E "^-" comparison_result.txt | grep -v "^---" | wc -l)
    
    echo "  ‚Ä¢ –ó–º—ñ–Ω–µ–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤: $CHANGED_FILES"
    echo "  ‚Ä¢ –î–æ–¥–∞–Ω–∏—Ö —Ä—è–¥–∫—ñ–≤: $ADDED_LINES"
    echo "  ‚Ä¢ –í–∏–¥–∞–ª–µ–Ω–∏—Ö —Ä—è–¥–∫—ñ–≤: $REMOVED_LINES"
fi

echo ""
echo "=========================================="

